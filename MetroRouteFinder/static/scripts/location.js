function showLocation(a){EarthLatLon=[a.coords.latitude,a.coords.longitude],$("#earth").html(EarthLatLon[0]+" "+EarthLatLon[1]),toMars(EarthLatLon)}function showPicture(a,b,c){var d="https://m.amap.com/navi/?";d+="start="+a,d+="&dest="+b,d+="&destName="+c,d+="&naviby=bus&key="+DisplayKey,$("#walkMap").attr({src:d})}function obtainStationLocation(a){city=$("#CurrentCity").text(),url="http://restapi.amap.com/v3/geocode/geo",dict={key:GaodeKey,address:a+"地铁站",city:city},$.get("/Station/"+a,function(){})}function myPos(a){$("#"+a+"Input").val(nearestStation[0]),check()}function obtainNeighbor(a){city=$("#CurrentCity").text(),url="https://restapi.amap.com/v3/place/around",dict={key:GaodeKey,location:a[0]+","+a[1],keywords:"地铁站",radius:5e4},""!=city&&(dict["city"]=city),$.get(url,dict,function(b){pois=b["pois"],StationName=pois[0]["name"].split("(")[0],StationLonLat=pois[0]["location"],CityName=pois[0]["cityname"].replace("市",""),$("#demo").html("您当前位于"),$("#demo").append($("<a>",{href:CityName,"class":"btn btn-info CityList"}).html(CityName)),$("#demo").append("，最近的地铁站是"+StationName),$("#status").html("获取成功"),$("#fromInput").val(StationName),$("#location").html(CityName+"市"+StationName+"站附近"),nearestStation[0]=StationName,nearestStation[1]=StationLonLat,myPosition=a[0]+","+a[1],showPicture(myPosition,nearestStation[1],nearestStation[0])})}function toMars(a){url="https://restapi.amap.com/v3/assistant/coordinate/convert",$.get(url,{key:GaodeKey,locations:a[1]+","+a[0],coordsys:"gps"},function(a){MarsLonLat=a["locations"].split(","),$("#mars").html(MarsLonLat[1]+" "+MarsLonLat[0]),obtainNeighbor(MarsLonLat)})}function displayNotice(a){$("#status").html(a)}function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showLocation,showError):displayNotice("浏览器不支持定位。")}function showError(a){switch(a.code){case a.PERMISSION_DENIED:displayNotice("您拒绝提供位置信息，因此我们无法为您定位。");break;case a.POSITION_UNAVAILABLE:displayNotice("我们不知道您在哪儿。");break;case a.TIMEOUT:displayNotice("暂时无法获得位置信息。");break;case a.UNKNOWN_ERROR:displayNotice("发生了无法处理的意外事件。")}}function resize(){a=$("#navbarcontainer").height()+20,$("body").attr("style","padding-top: "+a+"px")}var nearestStation=[],myPosition="";$(window).resize(resize),$(function(){resize(),getLocation(),""!=$("#CurrentCity").text()&&init()});